from collections import defaultdict
from unittest.mock import patch

from numpy import nan, array
from pandas._testing import assert_frame_equal
from pymatgen.entries.computed_entries import ComputedStructureEntry

import pandas as pd

from piro.reactions import Reaction
from piro.route import SynthesisRoutes

TARGET_ENTRY_DICT = {
    '@module': 'pymatgen.entries.computed_entries',
    '@class': 'ComputedStructureEntry',
    'energy': -95.07177656,
    'composition': defaultdict(float, {'Ca': 6.0, 'V': 2.0, 'N': 6.0}),
    'entry_id': 'mp-9029',
    'correction': 0.0,
    'energy_adjustments': [],
    'parameters': {'run_type': 'GGA',
                   'is_hubbard': False,
                   'pseudo_potential': {'functional': 'PBE',
                                        'labels': ['Ca_sv', 'V_pv', 'N'],
                                        'pot_type': 'paw'},
                   'hubbards': {},
                   'potcar_symbols': ['PBE Ca_sv', 'PBE V_pv', 'PBE N'],
                   'oxide_type': 'None'},
    'data': {'oxide_type': 'None',
             'icsd_ids': [41060, 72118],
             'formation_energy_per_atom': -1.215528256428571},
    'structure': {'@module': 'pymatgen.core.structure',
                  '@class': 'Structure',
                  'charge': None,
                  'lattice': {'matrix': [[4.266144, -5.206064, 0.0],
                                         [4.266144, 5.206064, 0.0],
                                         [0.0, 0.0, 5.086566]],
                              'a': 6.730756792577785,
                              'b': 6.730756792577785,
                              'c': 5.086566,
                              'alpha': 90.0,
                              'beta': 90.0,
                              'gamma': 101.3337314975841,
                              'volume': 225.9434173028464},
                  'sites': [{'species': [{'element': 'Ca', 'occu': 1}],
                             'abc': [0.597883, 0.827979, 0.25],
                             'xyz': [6.082932616128, 1.1978945021439997, 1.2716415],
                             'label': 'Ca',
                             'properties': {'magmom': -0.0}},
                            {'species': [{'element': 'Ca', 'occu': 1}],
                             'abc': [0.402117, 0.172021, 0.75],
                             'xyz': [2.4493553838719997, -1.197894502144, 3.8149245],
                             'label': 'Ca',
                             'properties': {'magmom': -0.0}},
                            {'species': [{'element': 'Ca', 'occu': 1}],
                             'abc': [0.891408, 0.108592, 0.75],
                             'xyz': [4.266144, -4.075390196223999, 3.8149245],
                             'label': 'Ca',
                             'properties': {'magmom': 0.0}},
                            {'species': [{'element': 'Ca', 'occu': 1}],
                             'abc': [0.108592, 0.891408, 0.25],
                             'xyz': [4.266144, 4.075390196223999, 1.2716415],
                             'label': 'Ca',
                             'properties': {'magmom': 0.0}},
                            {'species': [{'element': 'Ca', 'occu': 1}],
                             'abc': [0.827979, 0.597883, 0.75],
                             'xyz': [6.082932616128, -1.1978945021439995, 3.8149245],
                             'label': 'Ca',
                             'properties': {'magmom': -0.0}},
                            {'species': [{'element': 'Ca', 'occu': 1}],
                             'abc': [0.172021, 0.402117, 0.25],
                             'xyz': [2.4493553838719997, 1.197894502144, 1.2716415],
                             'label': 'Ca',
                             'properties': {'magmom': -0.0}},
                            {'species': [{'element': 'V', 'occu': 1}],
                             'abc': [0.302465, 0.697535, 0.75],
                             'xyz': [4.266144, 2.05675970448, 3.8149245],
                             'label': 'V',
                             'properties': {'magmom': 0.0}},
                            {'species': [{'element': 'V', 'occu': 1}],
                             'abc': [0.697535, 0.302465, 0.25],
                             'xyz': [4.266144, -2.05675970448, 1.2716415],
                             'label': 'V',
                             'properties': {'magmom': 0.0}},
                            {'species': [{'element': 'N', 'occu': 1}],
                             'abc': [0.81671, 0.569198, 0.25],
                             'xyz': [5.912483098752, -1.2885633127679998, 1.2716415],
                             'label': 'N',
                             'properties': {'magmom': -0.0}},
                            {'species': [{'element': 'N', 'occu': 1}],
                             'abc': [0.18329, 0.430802, 0.75],
                             'xyz': [2.619804901248, 1.2885633127679998, 3.8149245],
                             'label': 'N',
                             'properties': {'magmom': -0.0}},
                            {'species': [{'element': 'N', 'occu': 1}],
                             'abc': [0.872946, 0.127054, 0.25],
                             'xyz': [4.266144, -3.8831614890879997, 1.2716415],
                             'label': 'N',
                             'properties': {'magmom': 0.0}},
                            {'species': [{'element': 'N', 'occu': 1}],
                             'abc': [0.127054, 0.872946, 0.75],
                             'xyz': [4.266144, 3.8831614890879997, 3.8149245],
                             'label': 'N',
                             'properties': {'magmom': 0.0}},
                            {'species': [{'element': 'N', 'occu': 1}],
                             'abc': [0.430802, 0.18329, 0.25],
                             'xyz': [2.619804901248, -1.2885633127679998, 1.2716415],
                             'label': 'N',
                             'properties': {'magmom': -0.0}},
                            {'species': [{'element': 'N', 'occu': 1}],
                             'abc': [0.569198, 0.81671, 0.75],
                             'xyz': [5.912483098751999, 1.288563312768, 3.8149245],
                             'label': 'N',
                             'properties': {'magmom': -0.0}}]}
}
TARGET_ENTRY = ComputedStructureEntry.from_dict(TARGET_ENTRY_DICT)
ELTS = ['Ca', 'V', 'N']

PRECURSOR_DICTS = [
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'Ca': 24.0, 'N': 16.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -0.9333944734999996,
              'icsd_ids': [169725, 410754, 162791, 34678, 50991],
              'oxide_type': 'None'},
     'energy': -213.07809486,
     'energy_adjustments': [],
     'entry_id': 'mp-844',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE Ca_sv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['Ca_sv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 9.938093573687208,
                               'alpha': 109.47122063449069,
                               'b': 9.938093573687208,
                               'beta': 109.47122063449069,
                               'c': 9.938093573687208,
                               'gamma': 109.47122063449069,
                               'matrix': [[-5.737761, 5.737761, 5.737761],
                                          [5.737761, -5.737761, 5.737761],
                                          [5.737761, 5.737761, -5.737761]],
                               'volume': 755.5920051420769},
                   'sites': [{'abc': [0.271483, 0.006727, 0.043853],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-1.2674886181829998,
                                      1.7707246844489999,
                                      1.3446844546769998]},
                             {'abc': [0.735244, 0.228517, 0.27237],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-1.344684454677,
                                      4.470272381817,
                                      3.967036315551]},
                             {'abc': [0.037125, 0.493273, 0.764756],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [7.005255355944,
                                      1.7707189466879998,
                                      -1.344690192438]},
                             {'abc': [0.462875, 0.22763, 0.456147],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.2674828804220002,
                                      3.967042053312,
                                      1.344690192438]},
                             {'abc': [0.456147, 0.462875, 0.22763],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.344690192438,
                                      1.267482880422,
                                      3.967042053312]},
                             {'abc': [0.006727, 0.043853, 0.271483],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.7707246844489999,
                                      1.3446844546769998,
                                      -1.2674886181829998]},
                             {'abc': [0.27237, 0.735244, 0.228517],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [3.967036315551,
                                      -1.344684454677,
                                      4.470272381817]},
                             {'abc': [0.493273, 0.764756, 0.037125],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.7707189466879998,
                                      -1.344690192438,
                                      7.005255355944]},
                             {'abc': [0.764756, 0.037125, 0.493273],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-1.3446901924379997,
                                      7.005255355944,
                                      1.7707189466879996]},
                             {'abc': [0.228517, 0.27237, 0.735244],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [4.470272381817,
                                      3.967036315551,
                                      -1.3446844546770003]},
                             {'abc': [0.043853, 0.271483, 0.006727],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.3446844546769998,
                                      -1.2674886181829998,
                                      1.7707246844489999]},
                             {'abc': [0.22763, 0.456147, 0.462875],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [3.967042053312,
                                      1.3446901924379997,
                                      1.2674828804220002]},
                             {'abc': [0.506727, 0.235244, 0.962875],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [3.967042053312,
                                      7.0824511924380005,
                                      -1.267494355944]},
                             {'abc': [0.72763, 0.264756, 0.771483],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.770724684449,
                                      7.082445454677,
                                      1.267488618183]},
                             {'abc': [0.993273, 0.956147, 0.728517],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [3.967036315551,
                                      4.393076545323,
                                      7.005249618183]},
                             {'abc': [0.543853, 0.537125, 0.77237],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [4.393070807561999,
                                      4.470278119578,
                                      1.770718946688]},
                             {'abc': [0.537125, 0.77237, 0.543853],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [4.470278119578,
                                      1.7707189466880002,
                                      4.393070807561999]},
                             {'abc': [0.962875, 0.506727, 0.235244],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-1.2674943559439995,
                                      3.9670420533119994,
                                      7.0824511924380005]},
                             {'abc': [0.264756, 0.771483, 0.72763],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [7.082445454677,
                                      1.2674886181829996,
                                      1.770724684449]},
                             {'abc': [0.728517, 0.993273, 0.956147],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [7.005249618183,
                                      3.9670363155509993,
                                      4.393076545323]},
                             {'abc': [0.235244, 0.962875, 0.506727],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [7.082451192438,
                                      -1.2674943559439995,
                                      3.967042053312]},
                             {'abc': [0.771483, 0.72763, 0.264756],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.2674886181829998,
                                      1.770724684449,
                                      7.082445454676999]},
                             {'abc': [0.956147, 0.728517, 0.993273],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [4.393076545323,
                                      7.005249618183,
                                      3.9670363155510007]},
                             {'abc': [0.77237, 0.543853, 0.537125],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.7707189466879996,
                                      4.393070807562,
                                      4.470278119578001]},
                             {'abc': [0.710402, 0.460402, 0.25],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-2.220446049250313e-16,
                                      2.8688805000000004,
                                      5.283353279844]},
                             {'abc': [0.75, 0.789598, 0.039598],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.4544077201559999,
                                      1.1098776288287481e-16,
                                      8.6066415]},
                             {'abc': [0.039598, 0.75, 0.789598],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [8.6066415,
                                      0.4544077201560001,
                                      2.969270293391446e-16]},
                             {'abc': [0.25, 0.710402, 0.460402],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [5.2833532798439995,
                                      7.48824244141133e-17,
                                      2.8688805]},
                             {'abc': [0.460402, 0.25, 0.710402],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.8688805,
                                      5.2833532798439995,
                                      1.47162180510918e-16]},
                             {'abc': [0.789598, 0.039598, 0.75],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-2.220446049250313e-16,
                                      8.6066415,
                                      0.4544077201560006]},
                             {'abc': [0.289598, 0.539598, 0.75],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [5.737761, 2.8688805, 0.4544077201560006]},
                             {'abc': [0.25, 0.210402, 0.960402],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [5.2833532798439995,
                                      5.737761,
                                      -2.8688804999999995]},
                             {'abc': [0.960402, 0.25, 0.210402],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-2.8688805,
                                      5.283353279844,
                                      5.737760999999999]},
                             {'abc': [0.75, 0.289598, 0.539598],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.4544077201559999, 5.737761, 2.8688805]},
                             {'abc': [0.539598, 0.75, 0.289598],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.8688805, 0.45440772015600034, 5.737761]},
                             {'abc': [0.210402, 0.960402, 0.25],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [5.737761,
                                      -2.8688805000000004,
                                      5.283353279844]},
                             {'abc': [0.5, 0.0, 0.0],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-2.8688805, 2.8688805, 2.8688805]},
                             {'abc': [0.0, 0.0, 0.5],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.8688805, 2.8688805, -2.8688805]},
                             {'abc': [0.0, 0.5, 0.0],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.8688805, -2.8688805, 2.8688805]},
                             {'abc': [0.5, 0.5, 0.5],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.8688805, 2.8688805, 2.8688805]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'Ca': 2.0, 'N': 1.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -0.8759174183333336,
              'icsd_ids': [22231, 90631, 414329, 90630, 90632, 410312, 411417],
              'oxide_type': 'None'},
     'energy': -14.61444694,
     'energy_adjustments': [],
     'entry_id': 'mp-2686',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE Ca_sv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['Ca_sv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 6.742414843324905,
                               'alpha': 31.047557138295662,
                               'b': 6.742414843324905,
                               'beta': 31.047557138295662,
                               'c': 6.7424145257319354,
                               'gamma': 31.047552413838645,
                               'matrix': [[6.496448, -1.804528, 0.0],
                                          [6.496448, 1.804528, 0.0],
                                          [5.995201, 0.0, 3.08508]],
                               'volume': 72.33292337664713},
                   'sites': [{'abc': [0.731926, 0.731926, 0.731926],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [13.897881884821999,
                                      -3.1210585291319145e-17,
                                      2.25805026408]},
                             {'abc': [0.268074, 0.268074, 0.268074],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [5.090215115177999,
                                      -1.3449690186462247e-17,
                                      0.82702973592]},
                             {'abc': [0.0, 0.0, 0.0],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'V': 1.0, 'N': 1.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -1.3420210524999998,
              'icsd_ids': [169820, 236426, 236427, 236425, 191061],
              'oxide_type': 'None'},
     'energy': -19.7434431,
     'energy_adjustments': [],
     'entry_id': 'mp-1018027',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE V_pv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['V_pv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 2.7441136233824213,
                               'alpha': 90.0,
                               'b': 2.7441136233824213,
                               'beta': 90.0,
                               'c': 2.650884,
                               'gamma': 119.99999091990257,
                               'matrix': [[1.372057, -2.376472, 0.0],
                                          [1.372057, 2.376472, 0.0],
                                          [0.0, 0.0, 2.650884]],
                               'volume': 17.287236565507055},
                   'sites': [{'abc': [0.0, 0.0, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]},
                             {'abc': [0.666667, 0.333333, 0.5],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [1.372057, -0.7921589176480001, 1.325442]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'Ca': 8.0, 'V': 4.0, 'N': 12.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -1.3662283433333329,
              'icsd_ids': [409644],
              'oxide_type': 'None'},
     'energy': -180.87584266,
     'energy_adjustments': [],
     'entry_id': 'mp-17892',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE Ca_sv', 'PBE V_pv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['Ca_sv', 'V_pv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 5.942411068420797,
                               'alpha': 89.01747794285399,
                               'b': 5.942411068420797,
                               'beta': 89.01747794285399,
                               'c': 11.647217201513543,
                               'gamma': 123.35619316007734,
                               'matrix': [[5.231081, 2.819227, 0.0],
                                          [-5.231081, 2.819227, 0.0],
                                          [0.0, 0.420972, 11.639607]],
                               'volume': 343.31264799596096},
                   'sites': [{'abc': [0.614041, 0.839086, 0.077236],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-1.177228623645,
                                      4.129209066221001,
                                      0.898996686252]},
                             {'abc': [0.459739, 0.053925, 0.353026],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [2.1228459049339996,
                                      1.596749479,
                                      4.109083900782]},
                             {'abc': [0.053925, 0.459739, 0.853026],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-2.122845904934,
                                      1.807235479,
                                      9.928887400782]},
                             {'abc': [0.540261, 0.946075, 0.646974],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-2.1228459049339996,
                                      4.462676521,
                                      7.530523099218001]},
                             {'abc': [0.385959, 0.160914, 0.922764],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.177228623645,
                                      1.930216933779,
                                      10.740610313748]},
                             {'abc': [0.839086, 0.614041, 0.577236],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.1772286236450002,
                                      4.339695066220999,
                                      6.7188001862519995]},
                             {'abc': [0.160914, 0.385959, 0.422764],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [-1.1772286236449998,
                                      1.719730933779,
                                      4.920806813747999]},
                             {'abc': [0.946075, 0.540261, 0.146974],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [2.1228459049339996,
                                      4.252190521,
                                      1.710719599218]},
                             {'abc': [0.766684, 0.766516, 0.837667],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.0008788216080005789,
                                      4.675073188724,
                                      9.750114676869]},
                             {'abc': [0.233484, 0.233316, 0.662333],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.0008788216080000313,
                                      1.5948388112760001,
                                      7.709295823130999]},
                             {'abc': [0.233316, 0.233484, 0.162333],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [-0.0008788216079999897,
                                      1.384352811276,
                                      1.8894923231310001]},
                             {'abc': [0.766516, 0.766684, 0.337667],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [-0.0008788216080001765,
                                      4.464587188724,
                                      3.930311176869]},
                             {'abc': [0.088306, 0.911694, 0.75],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-4.307209322428,
                                      3.1349560000000003,
                                      8.72970525]},
                             {'abc': [0.911694, 0.088306, 0.25],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [4.307209322427999,
                                      2.9244700000000003,
                                      2.90990175]},
                             {'abc': [0.505681, 0.494319, 0.75],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.059435542322000115,
                                      3.1349560000000003,
                                      8.72970525]},
                             {'abc': [0.494319, 0.505681, 0.25],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-0.059435542322000406,
                                      2.924470000000001,
                                      2.90990175]},
                             {'abc': [0.339307, 0.012707, 0.128371],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [1.7084710546000001,
                                      1.0464479697900002,
                                      1.494187990197]},
                             {'abc': [0.987293, 0.660693, 0.371629],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [1.7084710546000001,
                                      4.80249203021,
                                      4.325615509803]},
                             {'abc': [0.660693, 0.987293, 0.871629],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-1.7084710545999997,
                                      5.012978030209999,
                                      10.145419009803]},
                             {'abc': [0.012707, 0.339307, 0.628371],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-1.7084710546,
                                      1.2569339697900002,
                                      7.313991490197]},
                             {'abc': [0.807582, 0.622125, 0.962352],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.970140589017,
                                      4.435791822633001,
                                      11.201399075664]},
                             {'abc': [0.622125, 0.807582, 0.462352],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-0.9701405890169997,
                                      4.225305822633,
                                      5.381595575664]},
                             {'abc': [0.192418, 0.377875, 0.037648],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-0.9701405890170001,
                                      1.623634177367,
                                      0.438207924336]},
                             {'abc': [0.377875, 0.192418, 0.537648],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.970140589017,
                                      1.8341201773670002,
                                      6.258011424336]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'V': 16.0, 'N': 2.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -0.3700965405555571,
              'icsd_ids': [644846],
              'oxide_type': 'None'},
     'energy': -167.9552247,
     'energy_adjustments': [],
     'entry_id': 'mp-1188283',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE V_pv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['V_pv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 8.698338,
                               'alpha': 90.0,
                               'b': 8.698338,
                               'beta': 90.0,
                               'c': 2.98975,
                               'gamma': 90.0,
                               'matrix': [[8.698338, 0.0, 0.0],
                                          [0.0, 8.698338, 0.0],
                                          [0.0, 0.0, 2.98975]],
                               'volume': 226.20772577611896},
                   'sites': [{'abc': [0.657879, 0.342121, 0.5],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [5.722453905101999,
                                      2.975884094898,
                                      1.494875]},
                             {'abc': [0.342121, 0.657879, 0.5],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [2.975884094898,
                                      5.722453905101999,
                                      1.494875]},
                             {'abc': [0.157879, 0.157879, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [1.373284905102, 1.373284905102, 0.0]},
                             {'abc': [0.842121, 0.842121, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [7.325053094898, 7.325053094898, 0.0]},
                             {'abc': [0.112597, 0.887403, 0.5],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.979406763786, 7.718931236214, 1.494875]},
                             {'abc': [0.887403, 0.112597, 0.5],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [7.718931236214, 0.979406763786, 1.494875]},
                             {'abc': [0.612597, 0.612597, 0.0],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [5.328575763786, 5.328575763786, 0.0]},
                             {'abc': [0.387403, 0.387403, 0.0],
                              'label': 'V',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [3.369762236214, 3.369762236214, 0.0]},
                             {'abc': [0.126502, 0.385574, 0.5],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [1.100357153676,
                                      3.3538529760119995,
                                      1.494875]},
                             {'abc': [0.873498, 0.614426, 0.5],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [7.597980846324, 5.344485023988, 1.494875]},
                             {'abc': [0.626502, 0.114426, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [5.449526153676, 0.995316023988, 0.0]},
                             {'abc': [0.373498, 0.885574, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [3.2488118463239997, 7.703021976012, 0.0]},
                             {'abc': [0.385574, 0.126502, 0.5],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [3.3538529760119995,
                                      1.100357153676,
                                      1.494875]},
                             {'abc': [0.614426, 0.873498, 0.5],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [5.344485023988, 7.597980846324, 1.494875]},
                             {'abc': [0.114426, 0.626502, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.995316023988, 5.449526153676, 0.0]},
                             {'abc': [0.885574, 0.373498, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [7.703021976012, 3.2488118463239997, 0.0]},
                             {'abc': [0.5, 0.5, 0.5],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [4.349169, 4.349169, 1.494875]},
                             {'abc': [0.0, 0.0, 0.0],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'V': 1.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': 0.0,
              'icsd_ids': [171003,
                           44873,
                           151408,
                           53792,
                           653395,
                           183412,
                           52537,
                           44322,
                           76167,
                           44509,
                           43420,
                           76269,
                           60614,
                           62131,
                           43619,
                           426983,
                           260470,
                           653393,
                           653398,
                           43718,
                           653399,
                           653394],
              'oxide_type': 'None'},
     'energy': -9.08390607,
     'energy_adjustments': [],
     'entry_id': 'mp-146',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE V_pv'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['V_pv'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 2.591619125942699,
                               'alpha': 109.47122063449069,
                               'b': 2.591619125942699,
                               'beta': 109.47122063449069,
                               'c': 2.591619125942699,
                               'gamma': 109.47122063449069,
                               'matrix': [[-1.496272, 1.496272, 1.496272],
                                          [1.496272, -1.496272, 1.496272],
                                          [1.496272, 1.496272, -1.496272]],
                               'volume': 13.399593956465264},
                   'sites': [{'abc': [0.0, 0.0, 0.0],
                              'label': 'V',
                              'properties': {'magmom': 0.009},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'N': 10.0}),
     'correction': -16.539111716200004,
     'data': {'formation_energy_per_atom': 2.0379339089999995,
              'icsd_ids': [290500],
              'oxide_type': 'None'},
     'energy': -62.98561016,
     'energy_adjustments': [{'@class': 'ConstantEnergyAdjustment',
                             '@module': 'pymatgen.entries.computed_entries',
                             '@version': '2021.3.9',
                             'cls': {'@class': 'MaterialsProjectCompatibility',
                                     '@module': 'pymatgen.entries.compatibility',
                                     '@version': '2021.3.9'},
                             'description': 'Constant energy adjustment',
                             'name': 'MP Gas Correction',
                             'uncertainty': nan,
                             'value': -16.539111716200004}],
     'entry_id': 'mp-1080711',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 4.985800048279815,
                               'alpha': 109.47122063449069,
                               'b': 4.985800048279815,
                               'beta': 109.47122063449069,
                               'c': 4.985800048279815,
                               'gamma': 109.47122063449069,
                               'matrix': [[-2.878553, 2.878553, 2.878553],
                                          [2.878553, -2.878553, 2.878553],
                                          [2.878553, 2.878553, -2.878553]],
                               'volume': 95.40753638832008},
                   'sites': [{'abc': [0.0, 0.713409, 0.713409],
                              'label': 'N',
                              'properties': {'magmom': 0.562},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [4.107171234354,
                                      -1.8274506570037375e-16,
                                      1.8274506570037375e-16]},
                             {'abc': [0.286591, 0.0, 0.286591],
                              'label': 'N',
                              'properties': {'magmom': 0.562},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.295327479018283e-17,
                                      1.649934765646,
                                      -2.295327479018283e-17]},
                             {'abc': [0.286591, 0.286591, 0.0],
                              'label': 'N',
                              'properties': {'magmom': 0.562},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.295327479018283e-17,
                                      -2.295327479018283e-17,
                                      1.649934765646]},
                             {'abc': [0.0, 0.286591, 0.286591],
                              'label': 'N',
                              'properties': {'magmom': 0.562},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [1.649934765646,
                                      2.295327479018283e-17,
                                      -2.295327479018283e-17]},
                             {'abc': [0.713409, 0.0, 0.713409],
                              'label': 'N',
                              'properties': {'magmom': 0.562},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-1.8274506570037375e-16,
                                      4.107171234354,
                                      1.8274506570037375e-16]},
                             {'abc': [0.713409, 0.713409, 0.0],
                              'label': 'N',
                              'properties': {'magmom': 0.562},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-1.8274506570037375e-16,
                                      1.8274506570037375e-16,
                                      4.107171234354]},
                             {'abc': [0.271904, 0.0, 0.0],
                              'label': 'N',
                              'properties': {'magmom': 0.202},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-0.7826900749119999,
                                      0.7826900749119999,
                                      0.7826900749119999]},
                             {'abc': [0.0, 0.271904, 0.0],
                              'label': 'N',
                              'properties': {'magmom': 0.202},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.7826900749119999,
                                      -0.7826900749119999,
                                      0.7826900749119999]},
                             {'abc': [0.0, 0.0, 0.271904],
                              'label': 'N',
                              'properties': {'magmom': 0.202},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.7826900749119999,
                                      0.7826900749119999,
                                      -0.7826900749119999]},
                             {'abc': [0.728096, 0.728096, 0.728096],
                              'label': 'N',
                              'properties': {'magmom': 0.202},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.0958629250880003,
                                      2.095862925088,
                                      2.095862925088]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'Ca': 2.0, 'N': 12.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -0.4628188142857143,
              'icsd_ids': [35227, 412259],
              'oxide_type': 'None'},
     'energy': -106.19660226,
     'energy_adjustments': [],
     'entry_id': 'mp-676',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE Ca_sv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['Ca_sv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 8.0175791508895,
                               'alpha': 77.40604967150573,
                               'b': 6.497273299150805,
                               'beta': 52.26787804858776,
                               'c': 6.323188914076346,
                               'gamma': 50.32607227990651,
                               'matrix': [[0.0, 5.569997, 5.766863],
                                          [2.992967, 0.0, 5.766863],
                                          [2.992967, 5.569997, 0.0]],
                               'volume': 192.2766379089},
                   'sites': [{'abc': [0.0, 0.0, 0.0],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]},
                             {'abc': [0.25, 0.25, 0.25],
                              'label': 'Ca',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [1.4964835, 2.7849985, 2.8834315]},
                             {'abc': [0.786996, 0.962625, 0.845759],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [5.412433635328,
                                      9.094440451735,
                                      10.089824608923]},
                             {'abc': [0.40462, 0.845759, 0.962625],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [5.412433635328,
                                      7.615550548264999,
                                      7.210764391077]},
                             {'abc': [0.623628, 0.623628, 0.876372],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [4.4894505, 8.3549955, 7.192754477927999]},
                             {'abc': [0.876372, 0.876372, 0.623628],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [4.4894505, 8.3549955, 10.107834522072]},
                             {'abc': [0.626372, 0.626372, 0.373628],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.9929670000000006,
                                      5.569997,
                                      7.224403022072]},
                             {'abc': [0.373628, 0.373628, 0.626372],
                              'label': 'N',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.992967, 5.569997, 4.309322977928]},
                             {'abc': [0.287375, 0.463004, 0.84538],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [3.9159501353280004,
                                      6.309441951735,
                                      4.327332891077]},
                             {'abc': [0.404241, 0.84538, 0.463004],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [3.915950135328,
                                      4.830552048265,
                                      7.206393108923]},
                             {'abc': [0.84538, 0.404241, 0.287375],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.069983864672,
                                      6.309441951735001,
                                      7.206393108923]},
                             {'abc': [0.463004, 0.287375, 0.404241],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.069983864672,
                                      4.830552048265,
                                      4.327332891077]},
                             {'abc': [0.962625, 0.786996, 0.40462],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [3.5664673646720004,
                                      7.615550548264999,
                                      10.089824608923]},
                             {'abc': [0.845759, 0.40462, 0.786996],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [3.566467364672,
                                      9.094440451735,
                                      7.210764391077]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'V': 6.0, 'N': 3.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -1.0904292561111109,
              'icsd_ids': [167802],
              'oxide_type': 'None'},
     'energy': -88.2437845,
     'energy_adjustments': [],
     'entry_id': 'mp-33090',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE V_pv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['V_pv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 4.905897743331489,
                               'alpha': 90.0,
                               'b': 4.905897743331489,
                               'beta': 90.0,
                               'c': 4.543337,
                               'gamma': 119.99999653864533,
                               'matrix': [[2.452949, -4.248632, 0.0],
                                          [2.452949, 4.248632, 0.0],
                                          [0.0, 0.0, 4.543337]],
                               'volume': 94.69838702758108},
                   'sites': [{'abc': [0.663685, 0.0, 0.753681],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [1.6279854570649999,
                                      -2.8197533289199996,
                                      3.424226773497]},
                             {'abc': [0.663685, 0.663685, 0.246319],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [3.2559709141299997,
                                      6.351551633088094e-17,
                                      1.1191102265030002]},
                             {'abc': [0.0, 0.336315, 0.246319],
                              'label': 'V',
                              'properties': {'magmom': 0.001},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.8249635429349998,
                                      1.4288786710799999,
                                      1.1191102265030002]},
                             {'abc': [0.0, 0.663685, 0.753681],
                              'label': 'V',
                              'properties': {'magmom': 0.001},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [1.6279854570649999,
                                      2.8197533289199996,
                                      3.424226773497]},
                             {'abc': [0.336315, 0.336315, 0.753681],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [1.6499270858699997,
                                      -7.731736488381102e-17,
                                      3.424226773497]},
                             {'abc': [0.336315, 0.0, 0.246319],
                              'label': 'V',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'V', 'occu': 1}],
                              'xyz': [0.8249635429349998,
                                      -1.4288786710799999,
                                      1.1191102265030002]},
                             {'abc': [0.0, 0.0, 0.0],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]},
                             {'abc': [0.333333, 0.666667, 0.5],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.452949, 1.4162134990880002, 2.2716685]},
                             {'abc': [0.666667, 0.333333, 0.5],
                              'label': 'N',
                              'properties': {'magmom': -0.0},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [2.452949,
                                      -1.4162134990880002,
                                      2.2716685]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'Ca': 1.0, 'N': 2.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': -0.7425045166666671,
              'icsd_ids': [423721],
              'oxide_type': 'None'},
     'energy': -20.18410328,
     'energy_adjustments': [],
     'entry_id': 'mp-1009657',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE Ca_sv', 'PBE N'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['Ca_sv', 'N'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 3.932340187457845,
                               'alpha': 125.14577321921938,
                               'b': 3.932340187457845,
                               'beta': 125.14577321921938,
                               'c': 3.932340187457845,
                               'gamma': 81.29672245505144,
                               'matrix': [[-1.811314, 1.811314, 2.983552],
                                          [1.811314, -1.811314, 2.983552],
                                          [1.811314, 1.811314, -2.983552]],
                               'volume': 39.15444664286524},
                   'sites': [{'abc': [0.0, 0.0, 0.0],
                              'label': 'Ca',
                              'properties': {'magmom': 0.0},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]},
                             {'abc': [0.605291, 0.605291, 0.0],
                              'label': 'N',
                              'properties': {'magmom': -0.001},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [8.132091110724107e-18,
                                      -8.132091110724107e-18,
                                      3.611834347264]},
                             {'abc': [0.394709, 0.394709, 0.0],
                              'label': 'N',
                              'properties': {'magmom': -0.001},
                              'species': [{'element': 'N', 'occu': 1}],
                              'xyz': [-8.132091110724107e-18,
                                      8.132091110724107e-18,
                                      2.3552696527359998]}]}},
    {'@class': 'ComputedStructureEntry',
     '@module': 'pymatgen.entries.computed_entries',
     'composition': defaultdict(float, {'Ca': 1.0}),
     'correction': 0.0,
     'data': {'formation_energy_per_atom': 0.0,
              'icsd_ids': [426932,
                           163538,
                           188390,
                           619184,
                           163534,
                           181067,
                           53768,
                           44727,
                           163536,
                           44348,
                           163542,
                           163540],
              'oxide_type': 'None'},
     'energy': -2.00559988,
     'energy_adjustments': [],
     'entry_id': 'mp-45',
     'parameters': {'hubbards': {},
                    'is_hubbard': False,
                    'oxide_type': 'None',
                    'potcar_symbols': ['PBE Ca_sv'],
                    'pseudo_potential': {'functional': 'PBE',
                                         'labels': ['Ca_sv'],
                                         'pot_type': 'paw'},
                    'run_type': 'GGA'},
     'structure': {'@class': 'Structure',
                   '@module': 'pymatgen.core.structure',
                   'charge': None,
                   'lattice': {'a': 3.8942986735033562,
                               'alpha': 59.99999999999999,
                               'b': 3.8942986735033562,
                               'beta': 59.99999999999999,
                               'c': 3.8942986735033562,
                               'gamma': 59.99999999999999,
                               'matrix': [[0.0, 2.753685, 2.753685],
                                          [2.753685, 0.0, 2.753685],
                                          [2.753685, 2.753685, 0.0]],
                               'volume': 41.76118103229138},
                   'sites': [{'abc': [0.0, 0.0, 0.0],
                              'label': 'Ca',
                              'properties': {'magmom': 0.001},
                              'species': [{'element': 'Ca', 'occu': 1}],
                              'xyz': [0.0, 0.0, 0.0]}]}}
]

PRECURSOR_LIBRARY = [ComputedStructureEntry.from_dict(p) for p in PRECURSOR_DICTS]
EXPECTED_REACTIONS = {
    'mp-1009657_mp-1018027_mp-2686': {'coeffs': [0.5714285714,
                                                 0.1428571429,
                                                 0.2857142857]},
    'mp-1009657_mp-1018027_mp-45': {'coeffs': [0.2857142857,
                                               0.4285714286,
                                               0.2857142857]},
    'mp-1009657_mp-1188283_mp-2686': {'coeffs': [0.4464285714,
                                                 0.3928571429,
                                                 0.1607142857]},
    'mp-1009657_mp-1188283_mp-45': {'coeffs': [0.2232142857,
                                               0.6160714286,
                                               0.1607142857]},
    'mp-1009657_mp-1188283_mp-844': {'coeffs': [0.5580357143,
                                                0.28125,
                                                0.1607142857]},
    'mp-1009657_mp-146_mp-2686': {'coeffs': [0.4285714286,
                                             0.4285714286,
                                             0.1428571429]},
    'mp-1009657_mp-146_mp-45': {'coeffs': [0.2142857143,
                                           0.6428571429,
                                           0.1428571429]},
    'mp-1009657_mp-146_mp-844': {'coeffs': [0.5357142857,
                                            0.3214285714,
                                            0.1428571429]},
    'mp-1009657_mp-2686_mp-33090': {'coeffs': [0.5, 0.2857142857, 0.2142857143]},
    'mp-1009657_mp-33090_mp-45': {'coeffs': [0.25, 0.5357142857, 0.2142857143]},
    'mp-1009657_mp-33090_mp-844': {'coeffs': [0.625, 0.1607142857, 0.2142857143]},
    'mp-1018027_mp-1080711_mp-2686': {'coeffs': [0.6428571429,
                                                 0.0714285714,
                                                 0.2857142857]},
    'mp-1018027_mp-1080711_mp-45': {'coeffs': [0.4285714286,
                                               0.2857142857,
                                               0.2857142857]},
    'mp-1018027_mp-17892_mp-2686': {'coeffs': [0.4285714286,
                                               0.4285714286,
                                               0.1428571429]},
    'mp-1018027_mp-2686_mp-676': {'coeffs': [0.6233766234,
                                             0.0909090909,
                                             0.2857142857]},
    'mp-1018027_mp-45_mp-676': {'coeffs': [0.380952381,
                                           0.3333333333,
                                           0.2857142857]},
    'mp-1018027_mp-844': {'coeffs': [0.7142857143, 0.2857142857]},
    'mp-1080711_mp-1188283_mp-2686': {'coeffs': [0.6428571429,
                                                 0.1964285714,
                                                 0.1607142857]},
    'mp-1080711_mp-1188283_mp-45': {'coeffs': [0.4285714286,
                                               0.4107142857,
                                               0.1607142857]},
    'mp-1080711_mp-1188283_mp-844': {'coeffs': [0.7142857143,
                                                0.125,
                                                0.1607142857]},
    'mp-1080711_mp-146_mp-2686': {'coeffs': [0.6428571429,
                                             0.2142857143,
                                             0.1428571429]},
    'mp-1080711_mp-146_mp-45': {'coeffs': [0.4285714286,
                                           0.4285714286,
                                           0.1428571429]},
    'mp-1080711_mp-146_mp-844': {'coeffs': [0.7142857143,
                                            0.1428571429,
                                            0.1428571429]},
    'mp-1080711_mp-2686_mp-33090': {'coeffs': [0.6428571429,
                                               0.1428571429,
                                               0.2142857143]},
    'mp-1080711_mp-33090_mp-45': {'coeffs': [0.4285714286,
                                             0.3571428571,
                                             0.2142857143]},
    'mp-1080711_mp-33090_mp-844': {'coeffs': [0.7142857143,
                                              0.0714285714,
                                              0.2142857143]},
    'mp-1188283_mp-17892_mp-2686': {'coeffs': [0.3285714286,
                                               0.6285714286,
                                               0.0428571429]},
    'mp-1188283_mp-17892_mp-844': {'coeffs': [0.4864864865,
                                              0.444015444,
                                              0.0694980695]},
    'mp-1188283_mp-2686_mp-676': {'coeffs': [0.5892857143, 0.25, 0.1607142857]},
    'mp-1188283_mp-45_mp-676': {'coeffs': [0.3601190476,
                                           0.4791666667,
                                           0.1607142857]},
    'mp-1188283_mp-676_mp-844': {'coeffs': [0.6752232143,
                                            0.1640625,
                                            0.1607142857]},
    'mp-146_mp-17892_mp-2686': {'coeffs': [0.3214285714,
                                           0.6428571429,
                                           0.0357142857]},
    'mp-146_mp-17892_mp-844': {'coeffs': [0.5142857143,
                                          0.4285714286,
                                          0.0571428571]},
    'mp-146_mp-2686_mp-676': {'coeffs': [0.5844155844,
                                         0.2727272727,
                                         0.1428571429]},
    'mp-146_mp-45_mp-676': {'coeffs': [0.3571428571, 0.5, 0.1428571429]},
    'mp-146_mp-676_mp-844': {'coeffs': [0.6696428571, 0.1875, 0.1428571429]},
    'mp-17892_mp-2686_mp-33090': {'coeffs': [0.3571428571,
                                             0.5714285714,
                                             0.0714285714]},
    'mp-17892_mp-33090_mp-844': {'coeffs': [0.3673469388,
                                            0.5102040816,
                                            0.1224489796]},
    'mp-17892_mp-45': {'coeffs': [0.1428571429, 0.8571428571]},
    'mp-2686_mp-33090_mp-676': {'coeffs': [0.6038961039,
                                           0.1818181818,
                                           0.2142857143]},
    'mp-33090_mp-45_mp-676': {'coeffs': [0.369047619, 0.4166666667, 0.2142857143]},
    'mp-33090_mp-676_mp-844': {'coeffs': [0.6919642857, 0.09375, 0.2142857143]}
}

EPITAXIES = {
    'mp-1188283': 91.81403933439778,
    'mp-2686': 83.52641949779213,
    'mp-676': 218.78978514358238,
    'mp-1080711': 70.30961315266742,
    'mp-45': 89.72067568494661,
    'mp-146': 43.87192696758493,
    'mp-17892': 147.47604794386996,
    'mp-1018027': 109.1149034760973,
    'mp-844': 161.28371906084024,
    'mp-33090': 43.87326739499866,
    'mp-1009657': 52.49373450553602
}
SIMILARITIES = {
    'mp-1188283': 0.26,
    'mp-2686': 0.02,
    'mp-676': 0.23,
    'mp-1080711': 0.97,
    'mp-45': 0.88,
    'mp-146': 0.93,
    'mp-17892': 0.01,
    'mp-1018027': 0.02,
    'mp-844': 0.01,
    'mp-33090': 0.02,
    'mp-1009657': 0.01
}

EXPECTED_PLOT_DATA = [
    {'index': 'mp-1009657_mp-1018027_mp-2686',
     'n_competing': 10,
     'barrier': 0.5789189802480729,
     'summary': '1.3333 Ca2N(mp-2686) + 0.3333 CaN2(mp-1009657) + 1.0 VN(mp-1018027)',
     'energy': -0.22549735714285668,
     'enthalpy': -0.22549735714285668,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'CaN2', 'VN'], dtype='<U4')},
    {'index': 'mp-1009657_mp-1018027_mp-45',
     'n_competing': 12,
     'barrier': 0.19222015403712947,
     'summary': '2.0 Ca(mp-45) + 1.0 CaN2(mp-1009657) + 1.0 VN(mp-1018027)',
     'energy': -0.513877448571428,
     'enthalpy': -0.513877448571428,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'CaN2', 'VN'], dtype='<U4')},
    {'index': 'mp-1009657_mp-1188283_mp-2686',
     'n_competing': 11,
     'barrier': 0.20870340755772163,
     'summary': '1.0417 Ca2N(mp-2686) + 0.9167 CaN2(mp-1009657) + 0.125 V8N(mp-1188283)',
     'energy': -0.4733156905357133,
     'enthalpy': -0.4733156905357133,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'CaN2', 'V8N'], dtype='<U4')},
    {'index': 'mp-1009657_mp-1188283_mp-45',
     'n_competing': 13,
     'barrier': 0.14989673027000328,
     'summary': '1.5625 Ca(mp-45) + 1.4375 CaN2(mp-1009657) + 0.125 V8N(mp-1188283)',
     'energy': -0.6986126369642848,
     'enthalpy': -0.6986126369642848,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'CaN2', 'V8N'], dtype='<U4')},
    {'index': 'mp-1009657_mp-1188283_mp-844',
     'n_competing': 11,
     'barrier': 0.2339704914750757,
     'summary': '0.7812 Ca3N2(mp-844) + 0.6562 CaN2(mp-1009657) + 0.125 V8N(mp-1188283)',
     'energy': -0.4263516082254458,
     'enthalpy': -0.4263516082254458,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca3N2', 'CaN2', 'V8N'], dtype='<U5')},
    {'index': 'mp-1009657_mp-146_mp-2686',
     'n_competing': 12,
     'barrier': 0.1666290885704565,
     'summary': '1.0 Ca2N(mp-2686) + 1.0 CaN2(mp-1009657) + 1.0 V(mp-146)',
     'energy': -0.5219188557142851,
     'enthalpy': -0.5219188557142851,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca2N', 'CaN2', 'V'], dtype='<U4')},
    {'index': 'mp-1009657_mp-146_mp-45',
     'n_competing': 13,
     'barrier': 0.13330559124887414,
     'summary': '1.5 Ca(mp-45) + 1.5 CaN2(mp-1009657) + 1.0 V(mp-146)',
     'energy': -0.7382039242857136,
     'enthalpy': -0.7382039242857136,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca', 'CaN2', 'V'], dtype='<U4')},
    {'index': 'mp-1009657_mp-146_mp-844',
     'n_competing': 13,
     'barrier': 0.17982457701765836,
     'summary': '0.75 Ca3N2(mp-844) + 0.75 CaN2(mp-1009657) + 1.0 V(mp-146)',
     'energy': -0.47683333669642813,
     'enthalpy': -0.47683333669642813,
     'exp_precursors': '0.6667',
     'precursor_formulas': array(['Ca3N2', 'CaN2', 'V'], dtype='<U5')},
    {'index': 'mp-1009657_mp-2686_mp-33090',
     'n_competing': 11,
     'barrier': 0.26490659047170095,
     'summary': '1.1667 Ca2N(mp-2686) + 0.6667 CaN2(mp-1009657) + 0.5 V2N(mp-33090)',
     'energy': -0.33176198761904696,
     'enthalpy': -0.33176198761904696,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'CaN2', 'V2N'], dtype='<U4')},
    {'index': 'mp-1009657_mp-33090_mp-45',
     'n_competing': 12,
     'barrier': 0.15320162857579173,
     'summary': '1.75 Ca(mp-45) + 1.25 CaN2(mp-1009657) + 0.5 V2N(mp-33090)',
     'energy': -0.584094567619047,
     'enthalpy': -0.584094567619047,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'CaN2', 'V2N'], dtype='<U4')},
    {'index': 'mp-1009657_mp-33090_mp-844',
     'n_competing': 11,
     'barrier': 0.33290455838671207,
     'summary': '0.875 Ca3N2(mp-844) + 0.375 CaN2(mp-1009657) + 0.5 V2N(mp-33090)',
     'energy': -0.2791622154315475,
     'enthalpy': -0.2791622154315475,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca3N2', 'CaN2', 'V2N'], dtype='<U5')},
    {'index': 'mp-1018027_mp-1080711_mp-2686',
     'n_competing': 4,
     'barrier': 8.259215616280242,
     'summary': '1.5 Ca2N(mp-2686) + 0.25 N2(mp-1080711) + 1.0 VN(mp-1018027)',
     'energy': -0.0904245162846602,
     'enthalpy': -0.269003901071428,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'N2', 'VN'], dtype='<U4')},
    {'index': 'mp-1018027_mp-1080711_mp-45',
     'n_competing': 6,
     'barrier': 5.5247031510120665,
     'summary': '3.0 Ca(mp-45) + 1.0 N2(mp-1080711) + 1.0 VN(mp-1018027)',
     'energy': -0.11777613085292815,
     'enthalpy': -0.8320936699999997,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'N2', 'VN'], dtype='<U2')},
    {'index': 'mp-1018027_mp-2686_mp-676',
     'n_competing': 11,
     'barrier': 1.306907112973467,
     'summary': '1.4545 Ca2N(mp-2686) + 0.0909 CaN6(mp-676) + 1.0 VN(mp-1018027)',
     'energy': -0.24399278974025917,
     'enthalpy': -0.24399278974025917,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'CaN6', 'VN'], dtype='<U4')},
    {'index': 'mp-1018027_mp-45_mp-676',
     'n_competing': 14,
     'barrier': 0.3607608414735328,
     'summary': '2.6667 Ca(mp-45) + 0.3333 CaN6(mp-676) + 1.0 VN(mp-1018027)',
     'energy': -0.6778207319047616,
     'enthalpy': -0.6778207319047616,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'CaN6', 'VN'], dtype='<U4')},
    {'index': 'mp-1018027_mp-844',
     'n_competing': 2,
     'barrier': 3.272253412857058,
     'summary': '1.0 Ca3N2(mp-844) + 1.0 VN(mp-1018027)',
     'energy': -0.1653833317857143,
     'enthalpy': -0.1653833317857143,
     'exp_precursors': '0.5',
     'precursor_formulas': array(['Ca3N2', 'VN'], dtype='<U5')},
    {'index': 'mp-1080711_mp-1188283_mp-2686',
     'n_competing': 4,
     'barrier': 6.550559067484007,
     'summary': '1.5 Ca2N(mp-2686) + 0.6875 N2(mp-1080711) + 0.125 V8N(mp-1188283)',
     'energy': -0.1018653781756731,
     'enthalpy': -0.5929586863392848,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'N2', 'V8N'], dtype='<U4')},
    {'index': 'mp-1080711_mp-1188283_mp-45',
     'n_competing': 7,
     'barrier': 43.80863327826171,
     'summary': '3.0 Ca(mp-45) + 1.4375 N2(mp-1080711) + 0.125 V8N(mp-1188283)',
     'energy': -0.12921699274394127,
     'enthalpy': -1.1560484552678565,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'N2', 'V8N'], dtype='<U3')},
    {'index': 'mp-1080711_mp-1188283_mp-844',
     'n_competing': 8,
     'barrier': 2.1396301126981703,
     'summary': '1.0 Ca3N2(mp-844) + 0.4375 N2(mp-1080711) + 0.125 V8N(mp-1188283)',
     'energy': -0.1768241936767272,
     'enthalpy': -0.489338117053571,
     'exp_precursors': '0.5',
     'precursor_formulas': array(['Ca3N2', 'N2', 'V8N'], dtype='<U5')},
    {'index': 'mp-1080711_mp-146_mp-2686',
     'n_competing': 7,
     'barrier': 2.0669988271963304,
     'summary': '1.5 Ca2N(mp-2686) + 0.75 N2(mp-1080711) + 1.0 V(mp-146)',
     'energy': -0.11670033313969586,
     'enthalpy': -0.6524384874999993,
     'exp_precursors': '0.5',
     'precursor_formulas': array(['Ca2N', 'N2', 'V'], dtype='<U4')},
    {'index': 'mp-1080711_mp-146_mp-45',
     'n_competing': 8,
     'barrier': 190.07278908037654,
     'summary': '3.0 Ca(mp-45) + 1.5 N2(mp-1080711) + 1.0 V(mp-146)',
     'energy': -0.1440519477079638,
     'enthalpy': -1.215528256428571,
     'exp_precursors': '0.5',
     'precursor_formulas': array(['Ca', 'N2', 'V'], dtype='<U2')},
    {'index': 'mp-1080711_mp-146_mp-844',
     'n_competing': 8,
     'barrier': 0.5940953168736282,
     'summary': '1.0 Ca3N2(mp-844) + 0.5 N2(mp-1080711) + 1.0 V(mp-146)',
     'energy': -0.19165914864074973,
     'enthalpy': -0.5488179182142855,
     'exp_precursors': '1.0',
     'precursor_formulas': array(['Ca3N2', 'N2', 'V'], dtype='<U5')},
    {'index': 'mp-1080711_mp-2686_mp-33090',
     'n_competing': 4,
     'barrier': 6.897534383668158,
     'summary': '1.5 Ca2N(mp-2686) + 0.5 N2(mp-1080711) + 0.5 V2N(mp-33090)',
     'energy': -0.06161630590265399,
     'enthalpy': -0.41877507547618986,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'N2', 'V2N'], dtype='<U4')},
    {'index': 'mp-1080711_mp-33090_mp-45',
     'n_competing': 4,
     'barrier': 3.4124722705748,
     'summary': '3.0 Ca(mp-45) + 1.25 N2(mp-1080711) + 0.5 V2N(mp-33090)',
     'energy': -0.08896792047092217,
     'enthalpy': -0.9818648444047615,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'N2', 'V2N'], dtype='<U3')},
    {'index': 'mp-1080711_mp-33090_mp-844',
     'n_competing': 6,
     'barrier': 1.0730789337125497,
     'summary': '1.0 Ca3N2(mp-844) + 0.25 N2(mp-1080711) + 0.5 V2N(mp-33090)',
     'energy': -0.1365751214037083,
     'enthalpy': -0.315154506190476,
     'exp_precursors': '0.5',
     'precursor_formulas': array(['Ca3N2', 'N2', 'V2N'], dtype='<U5')},
    {'index': 'mp-1188283_mp-2686_mp-676',
     'n_competing': 13,
     'barrier': 0.4398321324143746,
     'summary': '1.375 Ca2N(mp-2686) + 0.25 CaN6(mp-676) + 0.125 V8N(mp-1188283)',
     'energy': -0.5241781301785706,
     'enthalpy': -0.5241781301785706,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'CaN6', 'V8N'], dtype='<U4')},
    {'index': 'mp-1188283_mp-45_mp-676',
     'n_competing': 15,
     'barrier': 2.9662842868538926,
     'summary': '2.5208 Ca(mp-45) + 0.4792 CaN6(mp-676) + 0.125 V8N(mp-1188283)',
     'energy': -0.9342811067559517,
     'enthalpy': -0.9342811067559517,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'CaN6', 'V8N'], dtype='<U4')},
    {'index': 'mp-1188283_mp-676_mp-844',
     'n_competing': 12,
     'barrier': 0.4151122626069478,
     'summary': '0.9453 Ca3N2(mp-844) + 0.1641 CaN6(mp-676) + 0.125 V8N(mp-1188283)',
     'energy': -0.44986762695591487,
     'enthalpy': -0.44986762695591487,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca3N2', 'CaN6', 'V8N'], dtype='<U5')},
    {'index': 'mp-146_mp-2686_mp-676',
     'n_competing': 14,
     'barrier': 0.2762652898621103,
     'summary': '1.3636 Ca2N(mp-2686) + 0.2727 CaN6(mp-676) + 1.0 V(mp-146)',
     'energy': -0.577405153506493,
     'enthalpy': -0.577405153506493,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca2N', 'CaN6', 'V'], dtype='<U4')},
    {'index': 'mp-146_mp-45_mp-676',
     'n_competing': 15,
     'barrier': 2.7481665035189966,
     'summary': '2.5 Ca(mp-45) + 0.5 CaN6(mp-676) + 1.0 V(mp-146)',
     'energy': -0.9841188492857138,
     'enthalpy': -0.9841188492857138,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca', 'CaN6', 'V'], dtype='<U4')},
    {'index': 'mp-146_mp-676_mp-844',
     'n_competing': 14,
     'barrier': 0.17153371719779226,
     'summary': '0.9375 Ca3N2(mp-844) + 0.1875 CaN6(mp-676) + 1.0 V(mp-146)',
     'energy': -0.503708786674107,
     'enthalpy': -0.503708786674107,
     'exp_precursors': '0.6667',
     'precursor_formulas': array(['Ca3N2', 'CaN6', 'V'], dtype='<U5')},
    {'index': 'mp-2686_mp-33090_mp-676',
     'n_competing': 12,
     'barrier': 0.38699736587413847,
     'summary': '1.4091 Ca2N(mp-2686) + 0.1818 CaN6(mp-676) + 0.5 V2N(mp-33090)',
     'energy': -0.3687528528138523,
     'enthalpy': -0.3687528528138523,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca2N', 'CaN6', 'V2N'], dtype='<U4')},
    {'index': 'mp-33090_mp-45_mp-676',
     'n_competing': 14,
     'barrier': 0.2408438056502627,
     'summary': '2.5833 Ca(mp-45) + 0.4167 CaN6(mp-676) + 0.5 V2N(mp-33090)',
     'energy': -0.7890236717857139,
     'enthalpy': -0.7890236717857139,
     'exp_precursors': '0.0',
     'precursor_formulas': array(['Ca', 'CaN6', 'V2N'], dtype='<U4')},
    {'index': 'mp-33090_mp-676_mp-844',
     'n_competing': 12,
     'barrier': 0.31200338455432075,
     'summary': '0.9688 Ca3N2(mp-844) + 0.0937 CaN6(mp-676) + 0.5 V2N(mp-33090)',
     'energy': -0.29259994042038684,
     'enthalpy': -0.29259994042038684,
     'exp_precursors': '0.3333',
     'precursor_formulas': array(['Ca3N2', 'CaN6', 'V2N'], dtype='<U5')}
]


@patch('piro.utils.deepcopy')
@patch(f'{Reaction.__module__}.deepcopy')
def test_get_reactions(rdeepcopy_mock, deepcopy_mock):
    # don't know why, but deepcopy throws errors during this test
    # maybe the preset PRECURSOR_LIBRARY data for this test is missing something.
    # note: the below workaround is as slow or slower than deepcopy, so don't replace the real code with it
    rdeepcopy_mock.side_effect = lambda entries: [ComputedStructureEntry.from_dict(e.as_dict()) for e in entries]
    deepcopy_mock.side_effect = lambda entries: [ComputedStructureEntry.from_dict(e.as_dict()) for e in entries]

    # mimics the jupyter notebook
    router = SynthesisRoutes(
        'mp-9029',
        pressure=0.001,

        # avoids cache and calculations
        epitaxies=EPITAXIES,
        similarities=SIMILARITIES,

        # avoids MP API call
        custom_target_entry=TARGET_ENTRY,
        entries=PRECURSOR_LIBRARY
    )
    router.recommend_routes(temperature=1600,
                            allow_gas_release=False,
                            max_component_precursors=2,
                            show_fraction_known_precursors=False,
                            show_known_precursors_only=False,
                            confine_competing_to_icsd=False,
                            display_peroxides=True,
                            custom_text=' - 1600K, 10<sup>-3</sup> atm, standard reactants',
                            w=640, h=480,
                            add_pareto=True, yrange=(-0.25, 9))

    # check the reactions are expected
    reactions_coeffs_only = {k: {'coeffs': [round(c, 10) for c in v['coeffs']]} for k, v in router.reactions.items()}
    assert reactions_coeffs_only == EXPECTED_REACTIONS

    # check the plot data is expected
    ignore_columns = [
        'n_competing',  # n_competing is different because I passed in a small subset of entries to SynthesisRoutes
        'summary',  # a single number has a rounding error on Mac only. but coeffs are already checked above
    ]
    assert_frame_equal(
        router.plot_data.sort_index().reset_index().drop(columns=ignore_columns),
        pd.DataFrame.from_records(EXPECTED_PLOT_DATA).drop(columns=ignore_columns)
    )

